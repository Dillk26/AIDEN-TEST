<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systems of Equations Test</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS (Inline SVGs to replace lucide-react dependency) ---
        const Calculator = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/>
            </svg>
        );
        const CheckCircle = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );
        const XCircle = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/>
            </svg>
        );
        const ArrowRight = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
            </svg>
        );
        const RefreshCw = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>
            </svg>
        );
        const PenTool = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/>
            </svg>
        );

        /**
         * UTILITIES & PARSING
         */

        // Parses input like "8/3", "2.5", "-5" into a float
        const parseNumber = (input) => {
            if (typeof input === 'number') return input;
            if (!input) return NaN;
            const str = input.trim();
            if (str.includes('/')) {
                const [num, den] = str.split('/');
                return parseFloat(num) / parseFloat(den);
            }
            return parseFloat(str);
        };

        // Checks if two values are close enough
        const isClose = (a, b, epsilon = 0.1) => Math.abs(a - b) < epsilon;

        /**
         * DATA: QUESTIONS
         */
        const QUESTIONS = [
            {
                id: 1,
                type: 'substitution',
                title: 'Solving by Substitution',
                instruction: 'Solve the system using substitution.',
                equations: ['y = 3x - 2', 'y = x + 6'],
                inputs: [{ label: 'x', answer: 4 }, { label: 'y', answer: 10 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Step 1: Set equations equal to each other.</strong></p>
                        <p>Since both equations equal y, we can write: <br />3x - 2 = x + 6</p>
                        <p><strong>Step 2: Solve for x.</strong></p>
                        <p>Subtract x from both sides: 2x - 2 = 6</p>
                        <p>Add 2 to both sides: 2x = 8</p>
                        <p>Divide by 2: x = 4</p>
                        <p><strong>Step 3: Solve for y.</strong></p>
                        <p>Substitute x=4 into the second equation: y = (4) + 6 = 10</p>
                        <p className="font-bold text-green-700">Solution: (4, 10)</p>
                    </div>
                )
            },
            {
                id: 2,
                type: 'substitution',
                title: 'Solving by Substitution',
                instruction: 'Solve the system using substitution.',
                equations: ['y = -2x + 5', '4x + y = 7'],
                inputs: [{ label: 'x', answer: 1 }, { label: 'y', answer: 3 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Step 1: Substitute the expression for y.</strong></p>
                        <p>Substitute (-2x + 5) for y in the second equation:</p>
                        <p>4x + (-2x + 5) = 7</p>
                        <p><strong>Step 2: Solve for x.</strong></p>
                        <p>Combine like terms: 2x + 5 = 7</p>
                        <p>Subtract 5: 2x = 2</p>
                        <p>Divide by 2: x = 1</p>
                        <p><strong>Step 3: Solve for y.</strong></p>
                        <p>Use the first equation: y = -2(1) + 5 = -2 + 5 = 3</p>
                        <p className="font-bold text-green-700">Solution: (1, 3)</p>
                    </div>
                )
            },
            {
                id: 3,
                type: 'elimination',
                title: 'Solving by Elimination',
                instruction: 'Solve the system using elimination.',
                equations: ['2x + 3y = 11', '2x + 3y = 1'],
                inputs: [{ label: 'Solution type (enter "no" for no solution, "inf" for infinite, or solve for x/y)', answer: 'no', isText: true }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Step 1: Eliminate a variable.</strong></p>
                        <p>Subtract the second equation from the first:</p>
                        <p>(2x + 3y) - (2x + 3y) = 11 - 1</p>
                        <p>0 = 10</p>
                        <p><strong>Step 2: Interpret the result.</strong></p>
                        <p>This statement is <strong>FALSE</strong>.</p>
                        <p>This indicates the lines are parallel and never intersect.</p>
                        <p className="font-bold text-green-700">Solution: No Solution</p>
                    </div>
                )
            },
            {
                id: 4,
                type: 'elimination',
                title: 'Solving by Elimination',
                instruction: 'Solve the system using elimination. (Fractions allowed, e.g., 8/3)',
                equations: ['4x - y = 9', '2x + y = 7'],
                inputs: [{ label: 'x', answer: 8/3 }, { label: 'y', answer: 5/3 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Step 1: Add the equations.</strong></p>
                        <p>The y terms (-y, +y) are opposites, so add equations:</p>
                        <p>(4x - y) + (2x + y) = 9 + 7</p>
                        <p>6x = 16</p>
                        <p><strong>Step 2: Solve for x.</strong></p>
                        <p>x = 16/6 = 8/3 (approx 2.67)</p>
                        <p><strong>Step 3: Solve for y.</strong></p>
                        <p>Substitute x=8/3 into 2x + y = 7:</p>
                        <p>2(8/3) + y = 7 → 16/3 + y = 7</p>
                        <p>y = 7 - 16/3 = 21/3 - 16/3 = 5/3 (approx 1.67)</p>
                        <p className="font-bold text-green-700">Solution: (8/3, 5/3)</p>
                    </div>
                )
            },
            {
                id: 5,
                type: 'graphing',
                title: 'Solving by Graphing',
                instruction: 'Graph both lines to find the solution. Click the grid to plot 2 points for Line 1, then 2 points for Line 2.',
                equations: ['y = x - 1', 'y = -2x + 5'],
                targetLines: [
                    { m: 1, b: -1 },
                    { m: -2, b: 5 }
                ],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Line 1: y = x - 1</strong></p>
                        <p>Slope = 1, Y-intercept = -1. Start at (0, -1), go up 1, right 1.</p>
                        <p><strong>Line 2: y = -2x + 5</strong></p>
                        <p>Slope = -2, Y-intercept = 5. Start at (0, 5), go down 2, right 1.</p>
                        <p><strong>Intersection:</strong></p>
                        <p>The lines cross at exactly <strong>(2, 1)</strong>.</p>
                    </div>
                )
            },
            {
                id: 6,
                type: 'graphing',
                title: 'Solving by Graphing',
                instruction: 'Graph both lines. (Hint: Rewrite standard form to slope-intercept if needed).',
                equations: ['y = 2x + 4', '2x - y = 3'],
                targetLines: [
                    { m: 2, b: 4 },
                    { m: 2, b: -3 } // 2x - y = 3 => -y = -2x + 3 => y = 2x - 3
                ],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Line 1: y = 2x + 4</strong></p>
                        <p>Slope = 2, Y-intercept = 4.</p>
                        <p><strong>Line 2: 2x - y = 3</strong></p>
                        <p>Rewrite: -y = -2x + 3 → y = 2x - 3.</p>
                        <p>Slope = 2, Y-intercept = -3.</p>
                        <p><strong>Analysis:</strong></p>
                        <p>The slopes are equal (m=2), but intercepts are different (4 vs -3). The lines are parallel.</p>
                        <p className="font-bold text-green-700">Solution: No Solution</p>
                    </div>
                )
            },
            {
                id: 7,
                type: 'mixed',
                title: 'Choosing a Method (Elimination)',
                instruction: 'Solve using Elimination (as requested).',
                equations: ['3x + 2y = 12', '6x - 2y = 8'],
                inputs: [{ label: 'x', answer: 20/9 }, { label: 'y', answer: 8/3 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Step 1: Add equations.</strong></p>
                        <p>The 2y terms cancel out.</p>
                        <p>(3x + 2y) + (6x - 2y) = 12 + 8</p>
                        <p>9x = 20 → x = 20/9</p>
                        <p><strong>Step 2: Solve for y.</strong></p>
                        <p>Substitute x=20/9 into 3x+2y=12:</p>
                        <p>3(20/9) + 2y = 12 → 20/3 + 2y = 36/3</p>
                        <p>2y = 16/3 → y = 8/3</p>
                        <p className="font-bold text-green-700">Solution: (20/9, 8/3)</p>
                    </div>
                )
            },
            {
                id: 8,
                type: 'mixed',
                title: 'Choosing a Method (Substitution)',
                instruction: 'Solve using Substitution (as requested).',
                equations: ['y = -x + 7', '2x + y = 9'],
                inputs: [{ label: 'x', answer: 2 }, { label: 'y', answer: 5 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Step 1: Substitute.</strong></p>
                        <p>Replace y in eq 2: 2x + (-x + 7) = 9</p>
                        <p>x + 7 = 9 → x = 2</p>
                        <p><strong>Step 2: Solve for y.</strong></p>
                        <p>y = -2 + 7 = 5</p>
                        <p className="font-bold text-green-700">Solution: (2, 5)</p>
                    </div>
                )
            },
            {
                id: 9,
                type: 'word',
                title: 'Word Problem: Theater Tickets',
                instruction: 'Adult tickets $12, Student $8. 95 tickets sold. Total $940. How many of each?',
                inputs: [{ label: 'Adult Tickets', answer: 45 }, { label: 'Student Tickets', answer: 50 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Equations:</strong></p>
                        <p>1) a + s = 95 → s = 95 - a</p>
                        <p>2) 12a + 8s = 940</p>
                        <p><strong>Solve:</strong></p>
                        <p>12a + 8(95 - a) = 940</p>
                        <p>12a + 760 - 8a = 940</p>
                        <p>4a = 180 → a = 45</p>
                        <p>s = 95 - 45 = 50</p>
                    </div>
                )
            },
            {
                id: 10,
                type: 'word',
                title: 'Word Problem: Cell Plans',
                instruction: 'Plan A: $30 + $5/GB. Plan B: $20 + $7/GB. Find GB where cost is equal.',
                inputs: [{ label: 'GB', answer: 5 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Set costs equal:</strong></p>
                        <p>30 + 5x = 20 + 7x</p>
                        <p>Subtract 5x: 30 = 20 + 2x</p>
                        <p>Subtract 20: 10 = 2x</p>
                        <p>x = 5 GB</p>
                    </div>
                )
            },
            {
                id: 11,
                type: 'word',
                title: 'Word Problem: School Play',
                instruction: 'Adult $10, Child $6. 120 sold, $960 total. Solve.',
                inputs: [{ label: 'Adult Tickets', answer: 60 }, { label: 'Child Tickets', answer: 60 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>System:</strong></p>
                        <p>1) a + c = 120</p>
                        <p>2) 10a + 6c = 960</p>
                        <p><strong>Solve (Elimination):</strong></p>
                        <p>Multiply top by -6: -6a - 6c = -720</p>
                        <p>Add to bottom: (-6a - 6c) + (10a + 6c) = -720 + 960</p>
                        <p>4a = 240 → a = 60</p>
                        <p>c = 60</p>
                    </div>
                )
            },
            {
                id: 12,
                type: 'word',
                title: 'Word Problem: Geometry',
                instruction: 'Perimeter 56. Length is 3 times Width. Find Area.',
                inputs: [{ label: 'Area', answer: 147 }],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>System:</strong></p>
                        <p>1) 2L + 2W = 56</p>
                        <p>2) L = 3W</p>
                        <p><strong>Substitute:</strong></p>
                        <p>2(3W) + 2W = 56 → 8W = 56 → W = 7</p>
                        <p>L = 3(7) = 21</p>
                        <p><strong>Area:</strong></p>
                        <p>Area = L × W = 21 × 7 = 147</p>
                    </div>
                )
            },
            {
                id: 13,
                type: 'graphing',
                title: 'Systems of Inequalities',
                instruction: 'Graph the boundary lines for: y >= -x + 2 and y < 2x - 1',
                equations: ['y >= -x + 2', 'y < 2x - 1'],
                targetLines: [
                    { m: -1, b: 2 },
                    { m: 2, b: -1 }
                ],
                explanation: (
                    <div className="space-y-2">
                        <p><strong>Line 1: y = -x + 2</strong></p>
                        <p>Solid line (due to ≥). Shade ABOVE.</p>
                        <p><strong>Line 2: y = 2x - 1</strong></p>
                        <p>Dashed line (due to &lt;). Shade BELOW.</p>
                        <p><strong>Solution Region:</strong></p>
                        <p>The overlap is the region to the right, between the two lines.</p>
                    </div>
                )
            }
        ];

        /**
         * COMPONENT: INTERACTIVE GRAPH
         */
        const InteractiveGraph = ({ onLinesUpdate, isReadOnly, resetTrigger }) => {
            const canvasRef = useRef(null);
            const [points, setPoints] = useState([]);
            
            // Reset when trigger changes
            useEffect(() => {
                setPoints([]);
            }, [resetTrigger]);

            const gridSize = 20; // pixels per unit
            const width = 400;
            const height = 400;
            const centerX = width / 2;
            const centerY = height / 2;

            // Convert screen coords to grid coords
            const toGrid = (px, py) => {
                const x = Math.round((px - centerX) / gridSize);
                const y = Math.round(-(py - centerY) / gridSize);
                return { x, y };
            };

            // Convert grid coords to screen coords
            const toScreen = (gx, gy) => {
                return {
                    x: centerX + gx * gridSize,
                    y: centerY - gy * gridSize
                };
            };

            const draw = (ctx) => {
                // Background
                ctx.fillStyle = '#f9fafb';
                ctx.fillRect(0, 0, width, height);

                // Grid lines
                ctx.beginPath();
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                for (let i = 0; i <= width; i += gridSize) {
                    ctx.moveTo(i, 0); ctx.lineTo(i, height);
                    ctx.moveTo(0, i); ctx.lineTo(width, i);
                }
                ctx.stroke();

                // Axes
                ctx.beginPath();
                ctx.strokeStyle = '#374151';
                ctx.lineWidth = 2;
                ctx.moveTo(centerX, 0); ctx.lineTo(centerX, height);
                ctx.moveTo(0, centerY); ctx.lineTo(width, centerY);
                ctx.stroke();

                // Draw user points
                points.forEach((p, idx) => {
                    const screen = toScreen(p.x, p.y);
                    ctx.beginPath();
                    // First 2 points = Line 1 (Blue), Next 2 = Line 2 (Red)
                    ctx.fillStyle = idx < 2 ? '#2563eb' : '#dc2626';
                    ctx.arc(screen.x, screen.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                });

                // Draw lines if enough points
                const drawLineFromPoints = (p1, p2, color) => {
                    if (!p1 || !p2) return;
                    
                    const s1 = toScreen(p1.x, p1.y);
                    const s2 = toScreen(p2.x, p2.y);
                    
                    // Calculate extended line for drawing to edge
                    const slope = (p2.y - p1.y) / (p2.x - p1.x);
                    
                    ctx.beginPath();
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;

                    if (!isFinite(slope)) {
                        // Vertical line
                        ctx.moveTo(s1.x, 0);
                        ctx.lineTo(s1.x, height);
                    } else {
                        // y = mx + b in grid coords
                        const b = p1.y - slope * p1.x;
                        
                        // Find left (x=-10) and right (x=10) points
                        const leftX = -10; 
                        const leftY = slope * leftX + b;
                        const rightX = 10;
                        const rightY = slope * rightX + b;

                        const start = toScreen(leftX, leftY);
                        const end = toScreen(rightX, rightY);
                        
                        ctx.moveTo(start.x, start.y);
                        ctx.lineTo(end.x, end.y);
                    }
                    ctx.stroke();
                };

                if (points.length >= 2) drawLineFromPoints(points[0], points[1], '#2563eb');
                if (points.length >= 4) drawLineFromPoints(points[2], points[3], '#dc2626');

                // Callback to parent with line data
                if (!isReadOnly && onLinesUpdate) {
                    // Calculate math slopes and intercepts for parent validation
                    const lines = [];
                    if (points.length >= 2) {
                        const p1 = points[0];
                        const p2 = points[1];
                        const m = (p2.y - p1.y) / (p2.x - p1.x);
                        const b = p1.y - m * p1.x;
                        lines.push({ m, b, isVertical: !isFinite(m), xInt: p1.x });
                    }
                    if (points.length >= 4) {
                        const p3 = points[2];
                        const p4 = points[3];
                        const m = (p4.y - p3.y) / (p4.x - p3.x);
                        const b = p3.y - m * p3.x;
                        lines.push({ m, b, isVertical: !isFinite(m), xInt: p3.x });
                    }
                    onLinesUpdate(lines);
                }
            };

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                draw(ctx);
            }, [points]);

            const handleClick = (e) => {
                if (isReadOnly || points.length >= 4) return;
                const rect = canvasRef.current.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const gridP = toGrid(x, y);
                setPoints([...points, gridP]);
            };

            return (
                <div className="flex flex-col items-center">
                    <canvas 
                        ref={canvasRef} 
                        width={width} 
                        height={height} 
                        onClick={handleClick}
                        className="border border-gray-300 rounded shadow-sm cursor-crosshair bg-white"
                    />
                    <div className="mt-2 text-sm text-gray-500">
                        {points.length === 0 && "Click to plot first point for Line 1"}
                        {points.length === 1 && "Click second point for Line 1"}
                        {points.length === 2 && "Click first point for Line 2"}
                        {points.length === 3 && "Click second point for Line 2"}
                        {points.length === 4 && "Graph complete. Submit answer."}
                    </div>
                </div>
            );
        };

        /**
         * MAIN COMPONENT
         */
        const SystemsTest = () => {
            const [currentIdx, setCurrentIdx] = useState(0);
            const [userInputs, setUserInputs] = useState({});
            const [graphLines, setGraphLines] = useState([]);
            const [showExplanation, setShowExplanation] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [score, setScore] = useState(0);
            const [isFinished, setIsFinished] = useState(false);
            const [graphResetCounter, setGraphResetCounter] = useState(0);

            const question = QUESTIONS[currentIdx];

            const handleInputChange = (idx, value) => {
                setUserInputs(prev => ({ ...prev, [idx]: value }));
            };

            const checkAnswer = () => {
                let correct = true;

                if (question.type === 'graphing') {
                    // Validate Graph
                    if (graphLines.length < 2) {
                        correct = false;
                    } else {
                        // Compare user lines to target lines
                        const match = (u, t) => {
                            // Handle vertical lines
                            if (u.isVertical && Math.abs(t.m) > 1000) return isClose(u.xInt, -t.b/t.m); 
                            // Standard lines
                            return isClose(u.m, t.m) && isClose(u.b, t.b);
                        };
                        
                        const t1 = question.targetLines[0];
                        const t2 = question.targetLines[1];
                        const u1 = graphLines[0];
                        const u2 = graphLines[1];

                        const perm1 = match(u1, t1) && match(u2, t2);
                        const perm2 = match(u1, t2) && match(u2, t1);

                        correct = perm1 || perm2;
                    }
                } else {
                    // Validate Text/Numeric inputs
                    question.inputs.forEach((input, idx) => {
                        const userVal = userInputs[idx];
                        if (input.isText) {
                            if (!userVal || userVal.toLowerCase() !== input.answer) correct = false;
                        } else {
                            const valNum = parseNumber(userVal);
                            if (isNaN(valNum) || !isClose(valNum, input.answer)) correct = false;
                        }
                    });
                }

                setIsCorrect(correct);
                if (correct) setScore(s => s + 1);
                setShowExplanation(true);
            };

            const nextQuestion = () => {
                if (currentIdx < QUESTIONS.length - 1) {
                    setCurrentIdx(c => c + 1);
                    setUserInputs({});
                    setGraphLines([]);
                    setGraphResetCounter(c => c + 1);
                    setShowExplanation(false);
                    setIsCorrect(false);
                } else {
                    setIsFinished(true);
                }
            };

            const resetTest = () => {
                setCurrentIdx(0);
                setScore(0);
                setIsFinished(false);
                setShowExplanation(false);
                setUserInputs({});
                setGraphLines([]);
                setGraphResetCounter(c => c + 1);
            };

            if (isFinished) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4 font-sans">
                        <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center">
                            <CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" />
                            <h2 className="text-2xl font-bold mb-2">Test Complete!</h2>
                            <p className="text-gray-600 mb-6">You scored {score} out of {QUESTIONS.length}</p>
                            <div className="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                                <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: `${(score / QUESTIONS.length) * 100}%` }}></div>
                            </div>
                            <button 
                                onClick={resetTest}
                                className="flex items-center justify-center gap-2 w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition"
                            >
                                <RefreshCw size={18} /> Retry Test
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-8 font-sans">
                    <div className="max-w-3xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-blue-600 p-6 text-white flex justify-between items-center">
                            <div>
                                <h1 className="text-xl md:text-2xl font-bold flex items-center gap-2">
                                    <Calculator size={24} /> Systems of Equations Test
                                </h1>
                                <p className="text-blue-100 text-sm mt-1">Question {currentIdx + 1} of {QUESTIONS.length}</p>
                            </div>
                            <div className="text-2xl font-bold opacity-80">{score} pts</div>
                        </div>

                        {/* Question Area */}
                        <div className="p-6 md:p-8">
                            <div className="mb-6">
                                <span className="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded uppercase tracking-wide">
                                    {question.type}
                                </span>
                                <h2 className="text-xl font-bold text-gray-800 mt-2">{question.title}</h2>
                                <p className="text-gray-600 mt-2">{question.instruction}</p>
                                
                                {/* Equations Display */}
                                <div className="mt-4 p-4 bg-gray-100 rounded-lg border border-gray-200 inline-block pr-12">
                                    {question.equations && question.equations.map((eq, i) => (
                                        <div key={i} className="font-mono text-lg text-gray-800 mb-1 last:mb-0">
                                            {i + 1}) {eq}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Input Area */}
                            {!showExplanation && (
                                <div className="space-y-6">
                                    {question.type === 'graphing' ? (
                                        <div className="space-y-4">
                                            <InteractiveGraph 
                                                onLinesUpdate={setGraphLines} 
                                                resetTrigger={graphResetCounter}
                                            />
                                            <div className="flex justify-center">
                                                <button 
                                                    onClick={() => setGraphResetCounter(c => c + 1)}
                                                    className="text-sm text-gray-500 hover:text-red-500 underline"
                                                >
                                                    Clear Graph
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {question.inputs.map((inp, idx) => (
                                                <div key={idx}>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">{inp.label}</label>
                                                    <input
                                                        type="text"
                                                        className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                                        placeholder={inp.isText ? "Answer..." : "e.g. 5 or 8/3"}
                                                        value={userInputs[idx] || ''}
                                                        onChange={(e) => handleInputChange(idx, e.target.value)}
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    <button
                                        onClick={checkAnswer}
                                        className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center justify-center gap-2 shadow-md mt-4"
                                    >
                                        Submit Answer
                                    </button>
                                </div>
                            )}

                            {/* Feedback & Explanation */}
                            {showExplanation && (
                                <div className={`mt-6 p-6 rounded-lg border ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        {isCorrect ? (
                                            <CheckCircle className="text-green-600 w-8 h-8" />
                                        ) : (
                                            <XCircle className="text-red-600 w-8 h-8" />
                                        )}
                                        <h3 className={`text-xl font-bold ${isCorrect ? 'text-green-800' : 'text-red-800'}`}>
                                            {isCorrect ? 'Correct!' : 'Incorrect'}
                                        </h3>
                                    </div>
                                    
                                    <div className="bg-white p-4 rounded border border-gray-200 text-gray-700 leading-relaxed">
                                        <h4 className="font-bold text-gray-900 mb-2 border-b pb-2 flex items-center gap-2">
                                            <PenTool size={16} /> Step-by-Step Solution
                                        </h4>
                                        {question.explanation}
                                    </div>

                                    <div className="mt-6 flex justify-end">
                                        <button
                                            onClick={nextQuestion}
                                            className="bg-gray-800 text-white py-2 px-6 rounded hover:bg-gray-900 transition flex items-center gap-2"
                                        >
                                            {currentIdx === QUESTIONS.length - 1 ? 'Finish Test' : 'Next Question'} <ArrowRight size={18} />
                                        </button>
                                    </div>
                                </div>
                            )}

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SystemsTest />);
    </script>
</body>
</html>
